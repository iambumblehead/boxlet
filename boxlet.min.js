// Filename: boxlet.full.js  
// Timestamp: 2014/05/10 (last modified)  
// Author(s): Bumblehead (www.bumblehead.com), Dan Pupius (www.pupius.co.uk)  

var domlt=function(t){var n=t.getBoundingClientRect();return[n.left,n.top]};var incrnum=function(n,r){return r=function(){return n++},r.toString=function(){return n++},r}(0);var eventhook=function(){var n={fnArr:[],addFn:function(n){"function"==typeof n&&(n.oname="fn"+incrnum,this.fnArr.push(n))},rmFn:function(n){var r=n.oname;"function"==typeof n&&(this.fnArr=this.fnArr.filter(function(n){return n.oname!==r}))},fire:function(n,r,t,f){this.fnArr.map(function(o){o(n,r,t,f)})}};return{proto:n,getNew:function(){var r=Object.create(n);return r.fnArr=[],r}}}();var beast=function(t){var n={frames:30,fpms:.03,mspf:.03,timer:null,frameindex:0,ngnArr:[],isKilled:!1,isComplete:!1,st:1,onComplete:function(t){return this.onCompleteHook.addFn(t),this},onKill:function(t){return this.onKillHook.addFn(t),this},onBegin:function(t){return this.onBeginHook.addFn(t),this},updateNgnItems:function(t){this.ngnArr.map(function(n){n.updatefn(t)})},initNgnItems:function(t,n){t=this.frames,this.ngnArr.map(function(n){n.init(t,n.opts),n.updatefn=n.getupdatefn(t,n.opts)})},killNgnItems:function(t,n){t=this.frames,this.ngnArr.map(function(n){n.kill(t,n.opts)})},completeNgns:function(t,n){t=this.frames,this.ngnArr.map(function(n){n.complete(t,n.opts)})},applyFnComplete:function(){(1===this.st||4===this.st)&&this.onCompleteHook.fire()},applyFnKill:function(){this.onKillHook.fire()},applyFnBegin:function(){this.onBeginHook.fire()},updateNgns:function(){var t=this;t.updateNgnItems(t.frameindex),++t.frameindex},updateAnimationState:function(){var t=this;t.isKilled?t.st=3:t.frameindex>=t.frames&&(t.st=4)},animate:function(){var t=this;!function n(){switch(t.updateAnimationState(),t.st){case 1:t.updateNgns(),t.timer=setTimeout(n,t.mspf);break;case 2:t.st=1;break;case 3:t.st=3,t.kill();break;default:t.st=4,t.complete()}}()},complete:function(){var t=this;t.isKilled||t.isComplete||(t.isComplete=!0,t.st=4,t.completeNgns(),t.applyFnComplete())},kill:function(){var t=this;t.isKilled||t.isComplete||(t.isKilled=!0,t.st=3,t.killNgnItems(),t.applyFnKill())},init:function(t){var n=this;"function"==typeof t&&n.onComplete(t),4===n.st&&(n.st=1,n.applyFnBegin(),n.isKilled=!1,n.isComplete=!1,n.frameindex=0,n.initNgnItems(),n.animate())},reinit:function(){var t=this;t.kill(),t.st=4,t.init()}};return t=function(t){var e;return e=Object.create(n),e.timer=null,e.onCompleteHook=eventhook.getNew(),e.onKillHook=eventhook.getNew(),e.onBeginHook=eventhook.getNew(),e.ngnArr=[],e.isKilled=!1,e.isComplete=!1,e.frameindex=0,e.st=4,e.frames=t.frames||30,e.fpms=(t.fps||30)/1e3,e.mspf=1/e.fpms,e},t.proto=n,t}();var elemst={up:function(a,s){var e,c="st-"+s,t=(s||"").match(/(\w*(?:-)|\b)(\w*)/)||[],m=t[2],l=t[1]||"";a&&m&&(e=a.className,e.match(c)||(t=new RegExp("st-("+l+"\\w*)"),e.match(t)?a.className=e.replace(t,c):a.className=e+" "+c))},rm:function(a,s){var e,c=new RegExp("[\b ]st-"+s+"(-\\w*)?");a&&(e=a.className,e.match(c)&&(a.className=e.replace(c,"")))},is:function(a,s){return a&&a.className.match("st-"+s)?!0:!1}};var beastplug=function(e,t){var n={className:":name-beast-animating",isclean:!0,doframeloop:function(e,t){for(var n=0,a=e-1;e>n;n++)t(n/a,n)},getComputed:function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},getasfilleddimarr:function(e,t){var n=Array.isArray;return[n(e)&&"number"==typeof e[0]?e[0]:t[0],n(e)&&"number"==typeof e[1]?e[1]:t[1]]},isanimated:function(e,t,n){return e[n]!==t[n]},getdata:function(e,t){},getupdatefn:function(e,t){return function(){}},init:function(e,t){elemst.up(t.elem,this.className),t.oparr=this.getdata(e,t)},clean:function(e,t){},kill:function(e,t){elemst.rm(t.elem,this.className),this.isclean&&this.clean(e,t)},complete:function(e,t){t.classNameEnd&&elemst.up(t.elem,t.classNameEnd),elemst.rm(t.elem,this.className),this.isclean&&this.clean(e,t)}};beast.proto[e]=function(a){var s=Object.create(n);return t(s),s.opts=a,s.className=s.className.replace(/:name/,e),"boolean"==typeof a.isclean&&(s.isclean=a.isclean),this.ngnArr.push(s),this}};var curved=function(){function n(n){return n*n*n}function r(n){return 3*n*n*(1-n)}function t(n){return 3*n*(1-n)*(1-n)}function u(n){return(1-n)*(1-n)*(1-n)}function e(n,r){var t=Math.min(n,r);return t&&-t}return function(c,i,o){var f=e(c,i),a=i+f,v=c+f,d="end"===o?a:v;return function(e){return Math.round(a*n(e)+d*r(e)+d*t(e)+v*u(e))-f}}}();beastplug("move",function(e){e.getdata=function(t,l){var a=l.elem,n=l.ease,r=domlt(a),i=e.getasfilleddimarr(l.ltbgn,r),d=e.getasfilleddimarr(l.ltend,r),o=[],s=e.isanimated(i,d,0),u=e.isanimated(i,d,1),f=s&&curved(i[0],d[0],n),c=u&&curved(i[1],d[1],n);return e.doframeloop(t,function(e,t){o.push([f&&f(e),c&&c(e)])}),e.isl=s,e.ist=u,e.ltarr=o,o},e.clean=function(e,t){var l=t.elem.style;l.top="",l.left=""},e.getupdatefn=function(t,l){var a,n=":0px",r=e.ltarr,i=l.elem.style,d=e.isl,o=e.ist;return function(e){a=r[e],d&&(i.left=n.replace(/:0/,a[0])),o&&(i.top=n.replace(/:0/,a[1]))}}});beastplug("color",function(r){r.extractRGBarr=function(r){return r.match(/^#/)?r.replace(/^#(\w\w\w)$/,"$1$1").match(/(\w\w)(\w\w)(\w\w)/).slice(1,4).map(function(r){return parseInt(r,16)}):r.match(/^rgba?/)?r.match(/^rgba?\((\d{1,3}), (\d{1,3}), (\d{1,3}),? ?(\d{1,3})?\)$/).slice(1,4).map(function(r){return parseInt(r,10)}):void 0},r.buildRGBarray=function(e,a,o,c){var t=[],n=a.ease,u=r.extractRGBarr(o),l=r.extractRGBarr(c),d=curved(u[0],l[0],n),g=curved(u[1],l[1],n),p=curved(u[2],l[2],n);return r.doframeloop(e,function(r,e){t.push([d(r),g(r),p(r)])}),t},r.clean=function(r,e){var a=e.elem.style;a.backgroundColor="",a.color=""},r.getdata=function(e,a){var o=a.elem,c=a.endColor||r.getComputed(o,"color"),t=a.endBackgroundColor||r.getComputed(o,"background-color"),n=a.bgnColor||r.getComputed(o,"color"),u=a.bgnBackgroundColor||r.getComputed(o,"background-color");a.fgarr=r.buildRGBarray(e,a,n,c),a.bgarr=r.buildRGBarray(e,a,u,t)},r.getupdatefn=function(r,e){var a,o,c=e.bgarr,t=e.fgarr,n=e.elem.style,u="rgb(:r, :g, :b)";return function(r){a=c[r],o=t[r],n.backgroundColor=u.replace(/:r/,a[0]).replace(/:g/,a[1]).replace(/:b/,a[2]),n.color=u.replace(/:r/,o[0]).replace(/:g/,o[1]).replace(/:b/,o[2])}}});var domopacity=function(t,e,i){return t=document.documentElement.style,i=function(){},"opacity"in t?(e=function(t,e){t.style.opacity=e},e.rm=function(t){t.style.opacity=""},e.is=function(t){return getComputedStyle(t,null).getPropertyValue("opacity")}):"filter"in t?(e=function(t,e){t.style.filter="alpha(opacity=:o)".replace(/:o/,100*e)},e.rm=function(t){t.style.filter=""},e.is=function(t){var e,i,n=/\Wopacity\s*=\s*([\d]+)/i,o=t.currentStyle;return"object"==typeof o?(e=o.filter,n.test(e)?(i=n.exec(e),i[1]/100):1):void 0}):e=e.rm=e.is=i,e}();beastplug("fade",function(e){e.getdata=function(o,n){var t=[],a=100*+(domopacity.is(n.elem,"opacity")||1),c=curved(a,n.endop,n.ease);return e.doframeloop(o,function(e,o){t.push(c(e)/100)}),t},e.clean=function(e,o){domopacity.rm(o.elem)},e.getupdatefn=function(e,o){var n=o.oparr||[],t=o.elem;return function(e){domopacity(t,n[e])}}});var domwh=function(n,i,t){return t="undefined"!=typeof document&&t,n=function(n){var i,t=[n.offsetWidth,n.offsetHeight];return t[0]||(i=n.style,"none"===i.display?(i.display="block",t=[n.offsetWidth,n.offsetHeight],i.display="none"):""===i.display&&(i.display="block",t=[n.offsetWidth,n.offsetHeight],i.display="")),t},n.window=function(){return window&&window.innerHeight?[window.innerWidth,window.innerHeight]:(i=t.documentElement)?(i=i.clientWidth?i:t.documentBody,[i.clientWidth,i.clientHeight]):null},n}();beastplug("shape",function(e){e.getdata=function(a,t){var i=t.elem,n=t.ease,r=domwh(i),d=e.getasfilleddimarr(t.whbgn,r),h=e.getasfilleddimarr(t.whend,r),l=[],s=e.isanimated(d,h,0),u=e.isanimated(d,h,1),c=s&&curved(d[0],h[0],n),f=u&&curved(d[1],h[1],n);return e.doframeloop(a,function(e,a){l.push([c&&c(e),f&&f(e)])}),e.isw=s,e.ish=u,e.wharr=l,l},e.clean=function(e,a){var t=a.elem.style;t.width="",t.height=""},e.getupdatefn=function(a,t){var i,n=":0px",r=e.wharr,d=t.elem.style,h=e.isw,l=e.ish;return function(e){i=r[e],h&&(d.width=n.replace(/:0/,i[0])),l&&(d.height=n.replace(/:0/,i[1]))}}});var domev={getElemAt:function(t){var e=function(){};return"object"==typeof t&&t&&("target"in t?e=function(t){return t.target}:"srcElement"in t&&(e=function(t){return t.srcElement})),(domev.getElemAt=e)(t)},stopDefaultAt:function(t){var e=function(){};return"object"==typeof t&&t&&(e=t.preventDefault?function(t){return t.preventDefault()}:function(t){return t.returnValue=!1}),(domev.stopDefaultAt=e)(t)},hasElem:function(t,e,n){return n=this.getElemAt(t,e),e&&n&&(e.isEqualNode(n)||e.contains(n))}};var lockfnthrottling=("object"==typeof module?module:{}).exports=function(t){var n={ms:500,timer:null,lastFn:null,throttledFn:function(t){var n=this;n.timer?n.lastFn=t:(n.timer=setTimeout(function(){n.lastFn&&(n.lastFn(),n.lastFn=null),clearTimeout(n.timer),n.timer=null},n.ms),t())}};return t=function(n){return t.getNew(n)},t.getNew=function(t){var e=Object.create(n);return e.ms=t.ms||500,e.timer=null,e.lastFn=null,function(t){e.throttledFn(t)}},t}();var lockfnrebounding=("object"==typeof module?module:{}).exports=function(n){var t={flag:!1,go:function(n){var t=this,e=t.flag;e===!1&&(t.flag=!0,"function"==typeof n?n(function(){t.flag=!1}):t.flag=!1)}};return n=function(t){var e=n.getNew();return function(){var n,o=arguments.length,f=arguments[--o];f="function"==typeof f?f:!1,n=[].slice.call(arguments,0,f?o:++o),e(function(e){n.push(function(){e(),"function"==typeof f&&f.apply(o,arguments)}),t.apply(o,n)})}},n.getNew=function(){var n=Object.create(t);return n.flag=!1,function(t){n.go(t)}},n}();var lockfnexpiring=function(n,i){var r=!0,t=function(){r&&!(r=!1)&&n()};return setTimeout(t,i),t};var lockfnqueuing=("object"==typeof module?module:{}).exports=function(t){var n={isActive:!1,fnArr:[],getValArr:[],callLimit:function(){var t=this,n=t.fnArr,e=t.getValArr;!function r(i,u,c){u=e.shift(),c=n.shift(),u(function(n,i,u){c&&c(n,i,u),e.length?r(e.length):t.isActive=!1})}(e.length)},queueAdd:function(t,n){var e=this;e.fnArr.push(t),e.getValArr.push(n),e.isActive===!1&&(e.isActive=!0,e.callLimit())}};return t=function(n){var e=function(){var t=arguments.length,r=arguments[--t],i=[].slice.call(arguments,0,t);if("function"!=typeof r)throw new Error("last param must be function");e.lock(r,function(e){i.push(e),n.apply(t,i)})};return(e.lock=t.getNew())&&e},t.getNew=function(){var t=Object.create(n);return t.isActive=!1,t.fnArr=[],t.getValArr=[],function(n,e){t.queueAdd(n,e)}},t}();var lockfncaching=function(n){var r={val:void 0,isActive:!1,funcArr:[],callFuncArr:function(n,r){var t=this,e=t.funcArr;for(t.isActive=!1;e.length;)e.pop()(n,r)},cacheVal:function(n,r){var t=this,e=t.val;t.funcArr.push(n),t.isActive===!1&&(t.isActive=void 0===e,"undefined"==typeof e?r(function(n,r){return n?t.callFuncArr(n,r):void t.callFuncArr(n,t.val=r)}):t.callFuncArr(null,e))}};return n=function(r){var t=function(){var n=arguments.length,e=arguments[--n],c=[].slice.call(arguments,0,n);if("function"!=typeof e)throw new Error("last param must be function");t.lock(e,function(t){c.push(t),r.apply(n,c)})};return(t.clear=function(){return(t.lock=n.getNew())&&t})()},n.namespace=function(r){var t=function(){var n=arguments.length,e=arguments[--n],c=arguments[--n],a=[].slice.call(arguments,0,++n);if("function"!=typeof e)throw new Error("last param must be function");if("string"!=typeof c)throw new Error("name param must be function");t.lock(c,e,function(t){a.push(t),r.apply(n,a)})};return(t.clear=function(){return(t.lock=n.getNamespaceNew())&&t})()},n.getNew=function(){var n=Object.create(r);return n.isActive=!1,n.funcArr=[],n.val=void 0,function(r,t){n.cacheVal(r,t)}},n.getNamespaceCache=function(){return function(r,t){return t[r]||(t[r]=n.getNew())}}(),n.getNamespaceNew=function(){var r={};return function(t,e,c){n.getNamespaceCache(t,r)(e,c)}},n}();var lockfn={queuing:lockfnqueuing,caching:lockfncaching,expiring:lockfnexpiring,rebounding:lockfnrebounding,throttling:lockfnthrottling};var lsn=function(n,t,e,o){function u(n){return/^(?:function|object|unknown)$/.test(typeof n)?!0:!1}return n="undefined"==typeof document||document.documentElement,t=function(){},e={add:function(e){return u(n.addEventListener)?e=function(n,t,e){n.addEventListener(t,e,!1)}:u(n.addatchEvent)&&(e=function(n,t,e){n.attachEvent("on"+t,function(n){e(n||window.event)})}),e||t}(),rm:function(e){return u(n.removeEventListener)?e=function(n,t,e){n.removeEventListener(t,e,!1)}:u(n.detachEvent)&&(e=function(n,t,e){n.detachEvent("on"+t,e)}),e||t}()},o=e.add,o.rm=e.rm,o}();var boxlet=function(e){e=function(){var t={beast:null,getContentFullElem:function(e){return e.getContentFullElem()},getContentPrevElem:function(e){return e.getContentPrevElem()},fadeOut:function(e){var t=this,n=t.beast;return e&&n.fade({classNameEnd:"vis-hide",ease:"end",elem:t.getContentFullElem(e),endop:0}).fade({classNameEnd:"vis-hide",ease:"end",elem:t.getContentPrevElem(e),endop:0}),t},fadeIn:function(e){var t=this,n=t.beast;return e&&n.fade({classNameEnd:"vis-show",elem:t.getContentFullElem(e),endop:100}).fade({classNameEnd:"vis-show",elem:t.getContentPrevElem(e),endop:100}),t},shrink:function(e){var t=this,n=t.beast;return e&&n.shape({elem:t.getContentFullElem(e),ease:"end",whend:[null,0],classNameEnd:"show-shut"}).shape({elem:t.getContentPrevElem(e),ease:"end",whbgn:[null,0],classNameEnd:"show-open"}),t},grow:function(e){var t=this,n=t.beast;return e&&n.shape({elem:t.getContentFullElem(e),ease:"end",whbgn:[null,0],classNameEnd:"show-open"}).shape({elem:t.getContentPrevElem(e),ease:"end",whend:[null,0],classNameEnd:"show-shut"}),t},then:function(){var t=this,n=e(t.beast);return t.beast.onComplete(function(){n.init()}),n},init:function(e){var t=this;return t.beast.init(e),t}},n=function(e){var n=Object.create(t);return n.beast=beast(e),e.getContentPrevElem&&(n.getContentPrevElem=e.getContentPrevElem),e.getContentFullElem&&(n.getContentFullElem=e.getContentFullElem),n};return n.proto=t,n.boxengine=e,n}();var t={boxId:"",boxTitleId:"",boxContentFullId:"",boxContentPrevId:"",shape:null,fade:null,beast:null,getEBI:function(e){return document.getElementById(e)},getBoxletElem:function(){return this.getEBI(this.boxId)},getTitleElem:function(){return this.getEBI(this.boxTitleId)},getContentFullElem:function(){return this.getEBI(this.boxContentFullId)},getContentPrevElem:function(){return this.getEBI(this.boxContentPrevId)},showFull:function(t){var n=this,o=(n.getBoxletElem(),e({frames:6}));o.fadeOut(this).then().grow(this).then().fadeIn(this),o.init(function(){"function"==typeof t&&t()})},showPrev:function(t){var n=this,o=(n.getBoxletElem(),e({frames:6}));o.fadeOut(n).then().shrink(n).then().fadeIn(n),o.init(function(){t(null,"done")})},isOpen:function(){var e=this.getContentFullElem();return e&&elemst.is(e,"show-open")},switchState:function(e){var t=this;t.isOpen()?t.showPrev(e):t.showFull(e)},reboundSwitchState:function(e){var t=this;t.reboundfn(function(e){t.switchState(function(){e()})})},attach:function(){var e=this,t=e.getTitleElem();e.reboundfn=lockfn.rebounding.getNew(),lsn(t,"click",function(t){return e.reboundSwitchState(),domev.stopDefaultAt(t)})}},n=function(e){var n=Object.create(t);return n.boxId=e.boxId,n.reboundfn=null,n.boxTitleId=e.boxTitleId,n.boxContentFullId=e.boxContentFullId,n.boxContentPrevId=e.boxContentPrevId,n.attach(),n};return n.boxengine=e,n.proto=t,n}();