// Filename: boxlet.full.js  
// Timestamp: 2014/05/10 (last modified)  
// Author(s): Bumblehead (www.bumblehead.com), Dan Pupius (www.pupius.co.uk)  

var domlt=function(t){var n=t.getBoundingClientRect();return[n.left,n.top]};var incrnum=function(n,r){return r=function(){return n++},r.toString=function(){return n++},r}(0);var eventhook=function(){var n={fnArr:[],addFn:function(n){"function"==typeof n&&(n.oname="fn"+incrnum,this.fnArr.push(n))},rmFn:function(n){var r=n.oname;"function"==typeof n&&(this.fnArr=this.fnArr.filter(function(n){return n.oname!==r}))},fire:function(n,r,t,f){this.fnArr.map(function(o){o(n,r,t,f)})}};return{proto:n,getNew:function(){var r=Object.create(n);return r.fnArr=[],r}}}();var beast=function(t){var n={frames:30,fpms:.03,mspf:.03,timer:null,frameindex:0,ngnArr:[],isKilled:!1,isComplete:!1,st:1,onComplete:function(t){return this.onCompleteHook.addFn(t),this},onKill:function(t){return this.onKillHook.addFn(t),this},onBegin:function(t){return this.onBeginHook.addFn(t),this},updateNgnItems:function(t){this.ngnArr.map(function(n){n.updatefn(t)})},initNgnItems:function(t){t=this.frames,this.ngnArr.map(function(n){n.init(t,n.opts),n.updatefn=n.getupdatefn(t,n.opts)})},killNgnItems:function(t){t=this.frames,this.ngnArr.map(function(n){n.kill(t,n.opts)})},completeNgns:function(t){t=this.frames,this.ngnArr.map(function(n){n.complete(t,n.opts)})},applyFnComplete:function(){(1===this.st||4===this.st)&&this.onCompleteHook.fire()},applyFnKill:function(){this.onKillHook.fire()},applyFnBegin:function(){this.onBeginHook.fire()},updateNgns:function(){var t=this;t.updateNgnItems(t.frameindex),++t.frameindex},updateAnimationState:function(){var t=this;t.isKilled?t.st=3:t.frameindex>=t.frames&&(t.st=4)},animate:function(){var t=this;!function n(){switch(t.updateAnimationState(),t.st){case 1:t.updateNgns(),t.timer=setTimeout(n,t.mspf);break;case 2:t.st=1;break;case 3:t.st=3,t.kill();break;default:t.st=4,t.complete()}}()},complete:function(){var t=this;t.isKilled||t.isComplete||(t.isComplete=!0,t.st=4,t.completeNgns(),t.applyFnComplete())},kill:function(){var t=this;t.isKilled||t.isComplete||(t.isKilled=!0,t.st=3,t.killNgnItems(),t.applyFnKill())},init:function(t){var n=this;"function"==typeof t&&n.onComplete(t),4===n.st&&(n.st=1,n.applyFnBegin(),n.isKilled=!1,n.isComplete=!1,n.frameindex=0,n.initNgnItems(),n.animate())},reinit:function(){var t=this;t.kill(),t.st=4,t.init()}};return t=function(t){var e;return e=Object.create(n),e.timer=null,e.onCompleteHook=eventhook.getNew(),e.onKillHook=eventhook.getNew(),e.onBeginHook=eventhook.getNew(),e.ngnArr=[],e.isKilled=!1,e.isComplete=!1,e.frameindex=0,e.st=4,e.frames=t.frames||30,e.fpms=(t.fps||30)/1e3,e.mspf=1/e.fpms,e},t.proto=n,t}();var elemst={up:function(a,e){var s,c="st-"+e,t=(e||"").match(/(\w*(?:-)|\b)(\w*)/)||[],m=t[2],n=t[1]||"";a&&m&&(s=a.className,s.match(c)||(t=new RegExp("st-("+n+"\\w*)"),a.className=s.match(t)?s.replace(t,c):s+" "+c))},rm:function(a,e){var s,c=new RegExp("[\b ]st-"+e+"(-\\w*)?");a&&(s=a.className,s.match(c)&&(a.className=s.replace(c,"")))},is:function(a,e){return a&&a.className.match("st-"+e)?!0:!1}};var beastplug=function(e,t){var n={className:":name-beast-animating",isclean:!0,doframeloop:function(e,t){for(var n=0,a=e-1;e>n;n++)t(n/a,n)},getComputed:function(e,t){return getComputedStyle(e,null).getPropertyValue(t)},isanimated:function(e,t,n){return e[n]!==t[n]},getdata:function(){},getupdatefn:function(){return function(){}},init:function(e,t){elemst.up(t.elem,this.className),t.oparr=this.getdata(e,t)},clean:function(){},kill:function(e,t){elemst.rm(t.elem,this.className),this.isclean&&this.clean(e,t)},complete:function(e,t){t.classNameEnd&&elemst.up(t.elem,t.classNameEnd),elemst.rm(t.elem,this.className),this.isclean&&this.clean(e,t)}};beast.proto[e]=function(a){var s=Object.create(n);return t(s),s.opts=a,s.className=s.className.replace(/:name/,e),"boolean"==typeof a.isclean&&(s.isclean=a.isclean),this.ngnArr.push(s),this}};var curved=function(){function n(n){return n*n*n}function r(n){return 3*n*n*(1-n)}function t(n){return 3*n*(1-n)*(1-n)}function u(n){return(1-n)*(1-n)*(1-n)}function e(n,r){var t=Math.min(n,r);return t&&-t}return function(c,i,o){var f=e(c,i),a=i+f,v=c+f,d="end"===o?a:v;return function(e){return Math.round(a*n(e)+d*r(e)+d*t(e)+v*u(e))-f}}}();beastplug("move",function(e){e.getdata=function(t,n){var l=n.elem,a=n.ease,r=domlt(l),i=n.ltbgn||r,o=n.ltend||r,u=[],c=e.isanimated(i,o,0),s=e.isanimated(i,o,1),f=c&&curved(i[0],o[0],a),d=s&&curved(i[1],o[1],a);return e.doframeloop(t,function(e){u.push([f&&f(e),d&&d(e)])}),e.isl=c,e.ist=s,e.ltarr=u,u},e.clean=function(e,t){var n=t.elem.style;n.top="",n.left=""},e.getupdatefn=function(t,n){var l,a=":0px",r=e.ltarr,i=n.elem.style,o=e.isl,u=e.ist;return function(e){l=r[e],o&&(i.left=a.replace(/:0/,l[0])),u&&(i.top=a.replace(/:0/,l[1]))}}});beastplug("color",function(r){r.extractRGBarr=function(r){return r.match(/^#/)?r.replace(/^#(\w\w\w)$/,"$1$1").match(/(\w\w)(\w\w)(\w\w)/).slice(1,4).map(function(r){return parseInt(r,16)}):r.match(/^rgba?/)?r.match(/^rgba?\((\d{1,3}), (\d{1,3}), (\d{1,3}),? ?(\d{1,3})?\)$/).slice(1,4).map(function(r){return parseInt(r,10)}):void 0},r.buildRGBarray=function(e,a,o,c){var t=[],n=a.ease,u=r.extractRGBarr(o),l=r.extractRGBarr(c),d=curved(u[0],l[0],n),g=curved(u[1],l[1],n),p=curved(u[2],l[2],n);return r.doframeloop(e,function(r){t.push([d(r),g(r),p(r)])}),t},r.clean=function(r,e){var a=e.elem.style;a.backgroundColor="",a.color=""},r.getdata=function(e,a){var o=a.elem,c=a.endColor||r.getComputed(o,"color"),t=a.endBackgroundColor||r.getComputed(o,"background-color"),n=a.bgnColor||r.getComputed(o,"color"),u=a.bgnBackgroundColor||r.getComputed(o,"background-color");a.fgarr=r.buildRGBarray(e,a,n,c),a.bgarr=r.buildRGBarray(e,a,u,t)},r.getupdatefn=function(r,e){var a,o,c=e.bgarr,t=e.fgarr,n=e.elem.style,u="rgb(:r, :g, :b)";return function(r){a=c[r],o=t[r],n.backgroundColor=u.replace(/:r/,a[0]).replace(/:g/,a[1]).replace(/:b/,a[2]),n.color=u.replace(/:r/,o[0]).replace(/:g/,o[1]).replace(/:b/,o[2])}}});var domopacity=function(t,e,i){return t=document.documentElement.style,i=function(){},"opacity"in t?(e=function(t,e){t.style.opacity=e},e.rm=function(t){t.style.opacity=""},e.is=function(t){return getComputedStyle(t,null).getPropertyValue("opacity")}):"filter"in t?(e=function(t,e){t.style.filter="alpha(opacity=:o)".replace(/:o/,100*e)},e.rm=function(t){t.style.filter=""},e.is=function(t){var e,i,n=/\Wopacity\s*=\s*([\d]+)/i,o=t.currentStyle;return"object"==typeof o?(e=o.filter,n.test(e)?(i=n.exec(e),i[1]/100):1):void 0}):e=e.rm=e.is=i,e}();beastplug("fade",function(e){e.getdata=function(o,n){var t=[],a=100*+(domopacity.is(n.elem,"opacity")||1),c=curved(a,n.endop,n.ease);return e.doframeloop(o,function(e){t.push(c(e)/100)}),t},e.clean=function(e,o){domopacity.rm(o.elem)},e.getupdatefn=function(e,o){var n=o.oparr||[],t=o.elem;return function(e){domopacity(t,n[e])}}});var domwh=function(i,n,t){return t=document,i=function(i){var n,t=[i.offsetWidth,i.offsetHeight];return t[0]||(n=i.style,"none"===n.display?(n.display="block",t=[i.offsetWidth,i.offsetHeight],n.display="none"):""===n.display&&(n.display="block",t=[i.offsetWidth,i.offsetHeight],n.display="")),t},i.window=function(){return window&&window.innerHeight?[window.innerWidth,window.innerHeight]:(n=t.documentElement)?(n=n.clientWidth?n:t.documentBody,[n.clientWidth,n.clientHeight]):null},i}();beastplug("shape",function(e){e.getdata=function(t,n){var a=n.elem,i=n.ease,r=domwh(a),h=n.whbgn||r,u=n.whend||r,s=[],c=e.isanimated(h,u,0),d=e.isanimated(h,u,1),l=c&&curved(h[0],u[0],i),o=d&&curved(h[1],u[1],i);return e.doframeloop(t,function(e){s.push([l&&l(e),o&&o(e)])}),e.isw=c,e.ish=d,e.wharr=s,s},e.clean=function(e,t){var n=t.elem.style;n.width="",n.height=""},e.getupdatefn=function(t,n){var a,i=":0px",r=e.wharr,h=n.elem.style,u=e.isw,s=e.ish;return function(e){a=r[e],u&&(h.width=i.replace(/:0/,a[0])),s&&(h.height=i.replace(/:0/,a[1]))}}});var domev={getElemAt:function(t){var e=function(){};return"object"==typeof t&&t&&("target"in t?e=function(t){return t.target}:"srcElement"in t&&(e=function(t){return t.srcElement})),(domev.getElemAt=e)(t)},stopDefaultAt:function(t){var e=function(){};return"object"==typeof t&&t&&(e=t.preventDefault?function(t){return t.preventDefault()}:function(t){return t.returnValue=!1}),(domev.stopDefaultAt=e)(t)}};var lockfnthrottling=("object"==typeof module?module:{}).exports=function(){var t={ms:500,timer:null,lastFn:null,throttledFn:function(t){var n=this;n.timer?n.lastFn=t:(n.timer=setTimeout(function(){n.lastFn&&(n.lastFn(),n.lastFn=null),clearTimeout(n.timer),n.timer=null},n.ms),t())}};return{getNew:function(n){var l=Object.create(t);return l.ms=n.ms||500,l.timer=null,l.lastFn=null,function(t){l.throttledFn(t)}}}}();var lockfnrebounding=("object"==typeof module?module:{}).exports=function(){var n={flag:!1,go:function(n){var o=this,t=o.flag;t===!1&&(o.flag=!0,n(function(){o.flag=!1}))}};return{getNew:function(){var o=Object.create(n);return o.flag=!1,function(n){o.go(n)}}}}();var lockfnqueuing=("object"==typeof module?module:{}).exports=function(){var t={isActive:!1,fnArr:[],getValArr:[],callLimit:function(){var t=this,e=t.fnArr,r=t.getValArr;!function i(n,u,c){u=r.shift(),c=e.shift(),u(function(e,n,u){c&&c(e,n,u),r.length?i(r.length):t.isActive=!1})}(r.length)},queueAdd:function(t,e){var r=this;r.fnArr.push(t),r.getValArr.push(e),r.isActive===!1&&(r.isActive=!0,r.callLimit())}};return{getNew:function(){var e=Object.create(t);return e.isActive=!1,e.fnArr=[],e.getValArr=[],function(t,r){e.queueAdd(t,r)}}}}();var lockfncaching=("object"==typeof module?module:{}).exports=function(){var c={val:void 0,isActive:!1,funcArr:[],callFuncArr:function(c,e){var n=this,r=n.funcArr;for(n.isActive=!1;r.length;)r.pop()(c,e)},cacheVal:function(c,e){var n=this,r=n.val;n.funcArr.push(c),n.isActive===!1&&(n.isActive=void 0===r,"undefined"==typeof r?e(function(c,e){return c?n.callFuncArr(c,e):void n.callFuncArr(c,n.val=e)}):n.callFuncArr(null,r))}};return{getNew:function(){var e=Object.create(c);return e.isActive=!1,e.funcArr=[],e.val=void 0,function(c,n){e.cacheVal(c,n)}},getNamespaceCache:function(){var c={};return function(e){return c[e]||(c[e]=this.getNew())}}(),getNamespaceNew:function(){var c,e=this;return function(n,r,t){(c=e.getNamespaceCache(n))(r,t)}}}}();var lockfn=("object"==typeof module?module:{}).exports=function(){return{Queuing:lockfnqueuing,Caching:lockfncaching,Rebounding:lockfnrebounding,Throttling:lockfnthrottling}}();var lsn=function(n,t,e,o){function u(n){return/^(?:function|object|unknown)$/.test(typeof n)?!0:!1}return n="undefined"==typeof document||document.documentElement,t=function(){},e={add:function(e){return u(n.addEventListener)?e=function(n,t,e){n.addEventListener(t,e,!1)}:u(n.addatchEvent)&&(e=function(n,t,e){n.attachEvent("on"+t,function(n){e(n||window.event)})}),e||t}(),rm:function(e){return u(n.removeEventListener)?e=function(n,t,e){n.removeEventListener(t,e,!1)}:u(n.detachEvent)&&(e=function(n,t,e){n.detachEvent("on"+t,e)}),e||t}()},o=e.add,o.rm=e.rm,o}();var boxlet=function(e){e=function(){var t={beast:null,fadeOut:function(e){var t=this,n=t.beast;return e&&n.fade({classNameEnd:"vis-hide",ease:"end",elem:e.getContentFullElem(),endop:0}).fade({classNameEnd:"vis-hide",ease:"end",elem:e.getContentPrevElem(),endop:0}),t},fadeIn:function(e){var t=this,n=t.beast;return e&&n.fade({classNameEnd:"vis-show",elem:e.getContentFullElem(),endop:100}).fade({classNameEnd:"vis-show",elem:e.getContentPrevElem(),endop:100}),t},shrink:function(e){var t=this,n=t.beast;return e&&n.shape({elem:e.getContentFullElem(),ease:"end",whend:[null,0],classNameEnd:"show-shut"}).shape({elem:e.getContentPrevElem(),ease:"end",whbgn:[null,0],classNameEnd:"show-open"}),t},grow:function(e){var t=this,n=t.beast;return e&&n.shape({elem:e.getContentFullElem(),ease:"end",whbgn:[null,0],classNameEnd:"show-open"}).shape({elem:e.getContentPrevElem(),ease:"end",whend:[null,0],classNameEnd:"show-shut"}),t},then:function(){var t=this,n=e(t.beast);return t.beast.onComplete(function(){n.init()}),n},init:function(e){var t=this;return t.beast.init(e),t}},n=function(e){var n=Object.create(t);return n.beast=beast(e),n};return n.proto=t,n.boxengine=e,n}();var t={boxId:"",boxTitleId:"",boxContentFullId:"",boxContentPrevId:"",shape:null,fade:null,beast:null,getEBI:function(e){return document.getElementById(e)},getBoxletElem:function(){return this.getEBI(this.boxId)},getTitleElem:function(){return this.getEBI(this.boxTitleId)},getContentFullElem:function(){return this.getEBI(this.boxContentFullId)},getContentPrevElem:function(){return this.getEBI(this.boxContentPrevId)},showFull:function(t){var n=this,o=(n.getBoxletElem(),e({frames:6}));o.fadeOut(this).then().grow(this).then().fadeIn(this),o.init(function(){"function"==typeof t&&t()})},showPrev:function(t){var n=this,o=(n.getBoxletElem(),e({frames:6}));o.fadeOut(n).then().shrink(n).then().fadeIn(n),o.init(function(){t(null,"done")})},isOpen:function(){var e=this.getContentFullElem();return e&&elemst.is(e,"show-open")},switchState:function(e){var t=this;t.isOpen()?t.showPrev(e):t.showFull(e)},reboundSwitchState:function(){var e=this;e.reboundfn(function(t){e.switchState(function(){t()})})},attach:function(){var e=this,t=e.getTitleElem();e.reboundfn=lockfn.Rebounding.getNew(),lsn(t,"click",function(t){return e.reboundSwitchState(),domev.stopDefaultAt(t)})}},n=function(e){var n=Object.create(t);return n.boxId=e.boxId,n.reboundfn=null,n.boxTitleId=e.boxTitleId,n.boxContentFullId=e.boxContentFullId,n.boxContentPrevId=e.boxContentPrevId,n.attach(),n};return n.boxengine=e,n.proto=t,n}();